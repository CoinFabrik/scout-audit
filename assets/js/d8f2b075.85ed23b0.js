"use strict";(globalThis.webpackChunkdocs=globalThis.webpackChunkdocs||[]).push([[4517],{1256(e,t,n){n.r(t),n.d(t,{assets:()=>d,contentTitle:()=>i,default:()=>h,frontMatter:()=>o,metadata:()=>c,toc:()=>a});const c=JSON.parse('{"id":"detectors/soroban/contract-import-dependency","title":"Contract import dependency","description":"Description","source":"@site/docs/detectors/soroban/29-contract-import-dependency.md","sourceDirName":"detectors/soroban","slug":"/detectors/soroban/contract-import-dependency","permalink":"/scout-audit/docs/detectors/soroban/contract-import-dependency","draft":false,"unlisted":false,"editUrl":"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/detectors/soroban/29-contract-import-dependency.md","tags":[],"version":"current","sidebarPosition":29,"frontMatter":{},"sidebar":"tutorialSidebar","previous":{"title":"Ineffective extend_ttl","permalink":"/scout-audit/docs/detectors/soroban/ineffective-extend-ttl"},"next":{"title":"Missing new admin signature","permalink":"/scout-audit/docs/detectors/soroban/missing-new-admin-auth"}}');var r=n(2615),s=n(7545);const o={},i="Contract import dependency",d={},a=[{value:"Description",id:"description",level:2},{value:"Why is this bad?",id:"why-is-this-bad",level:2},{value:"Issue example",id:"issue-example",level:2},{value:"Remediated example",id:"remediated-example",level:2},{value:"How is it detected?",id:"how-is-it-detected",level:2}];function l(e){const t={a:"a",code:"code",h1:"h1",h2:"h2",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",ul:"ul",...(0,s.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(t.header,{children:(0,r.jsx)(t.h1,{id:"contract-import-dependency",children:"Contract import dependency"})}),"\n",(0,r.jsx)(t.h2,{id:"description",children:"Description"}),"\n",(0,r.jsxs)(t.ul,{children:["\n",(0,r.jsxs)(t.li,{children:["Category: ",(0,r.jsx)(t.code,{children:"Best practices"})]}),"\n",(0,r.jsxs)(t.li,{children:["Severity: ",(0,r.jsx)(t.code,{children:"Low"})]}),"\n",(0,r.jsxs)(t.li,{children:["Detector: ",(0,r.jsx)(t.a,{href:"https://github.com/CoinFabrik/scout-soroban/tree/main/detectors/contract-import-dependency",children:(0,r.jsx)(t.code,{children:"contract-import-dependency"})})]}),"\n",(0,r.jsxs)(t.li,{children:["Test Cases: ",(0,r.jsx)(t.a,{href:"https://github.com/CoinFabrik/scout-soroban/tree/main/test-cases/contract-import-dependency/vulnerable/vulnerable-1",children:(0,r.jsx)(t.code,{children:"contract-import-dependency-1"})})]}),"\n"]}),"\n",(0,r.jsxs)(t.p,{children:["The Soroban ",(0,r.jsx)(t.code,{children:"contractimport!"})," macro allows embedding a compiled WASM artifact directly into a contract. When the imported artifact is not tracked as a dependency, the project can compile and pass tests even if it ships an outdated version of that binary. Missing the ",(0,r.jsx)(t.code,{children:"/release/deps/"})," path convention also bypasses cargo's dependency resolution, leaving the project compiling a stale or incorrect contract."]}),"\n",(0,r.jsx)(t.h2,{id:"why-is-this-bad",children:"Why is this bad?"}),"\n",(0,r.jsxs)(t.p,{children:["If the embedded contract is not declared in ",(0,r.jsx)(t.code,{children:"Cargo.toml"}),", a developer may update the dependency source without rebuilding the binary that gets shipped. This causes the deployed contract to behave differently than the one exercised in tests, which hides bugs and can lead to production incidents. Using a path outside ",(0,r.jsx)(t.code,{children:"/release/deps/"})," has a similar effect because the WASM file is no longer tied to the dependency's build output."]}),"\n",(0,r.jsx)(t.h2,{id:"issue-example",children:"Issue example"}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-rust",children:'use soroban_sdk::{contract, contractimpl, contractimport, Env};\n\ncontractimport!(file = "../../../target/wasm32v1-none/release/dependency_contract.wasm");\n\n#[contract]\npub struct DependencyConsumer;\n\n#[contractimpl]\nimpl DependencyConsumer {\n    pub fn noop(_: Env) {}\n}\n'})}),"\n",(0,r.jsxs)(t.p,{children:["This example embeds ",(0,r.jsx)(t.code,{children:"dependency_contract.wasm"})," directly from the ",(0,r.jsx)(t.code,{children:"target/release"})," folder without declaring or rebuilding the dependency. The full vulnerable contract lives ",(0,r.jsx)(t.a,{href:"https://github.com/CoinFabrik/scout-soroban/tree/main/test-cases/contract-import-dependency/vulnerable/vulnerable-1",children:"here"}),"."]}),"\n",(0,r.jsx)(t.h2,{id:"remediated-example",children:"Remediated example"}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-rust",children:'mod contract_1 {\n    use soroban_sdk::contractimport;\n\n    contractimport!(file = "../../../target/wasm32v1-none/release/deps/dependency_contract.wasm");\n}\n'})}),"\n",(0,r.jsxs)(t.p,{children:["With the dependency added to ",(0,r.jsx)(t.code,{children:"Cargo.toml"}),", the generated WASM now lives under ",(0,r.jsx)(t.code,{children:"release/deps/"})," and stays in sync with the source crate. The remediated contract that calls into the generated client can be found ",(0,r.jsx)(t.a,{href:"https://github.com/CoinFabrik/scout-soroban/tree/main/test-cases/contract-import-dependency/remediated/remediated-1",children:"here"}),"."]}),"\n",(0,r.jsx)(t.h2,{id:"how-is-it-detected",children:"How is it detected?"}),"\n",(0,r.jsxs)(t.p,{children:["The detector scans every ",(0,r.jsx)(t.code,{children:"contractimport!"})," invocation that is not part of a unit test. It then verifies two conditions:"]}),"\n",(0,r.jsxs)(t.ol,{children:["\n",(0,r.jsxs)(t.li,{children:["The imported contract name appears in ",(0,r.jsx)(t.code,{children:"Cargo.toml"})," (either verbatim or using hyphenated naming)."]}),"\n",(0,r.jsxs)(t.li,{children:["The path passed to the macro includes ",(0,r.jsx)(t.code,{children:"/release/deps/"}),"."]}),"\n"]}),"\n",(0,r.jsx)(t.p,{children:"If either check fails, Scout flags the macro call so the developer can make the dependency explicit and use the canonical output location."})]})}function h(e={}){const{wrapper:t}={...(0,s.R)(),...e.components};return t?(0,r.jsx)(t,{...e,children:(0,r.jsx)(l,{...e})}):l(e)}},7545(e,t,n){n.d(t,{R:()=>o,x:()=>i});var c=n(9471);const r={},s=c.createContext(r);function o(e){const t=c.useContext(s);return c.useMemo(function(){return"function"==typeof e?e(t):{...t,...e}},[t,e])}function i(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:o(e.components),c.createElement(s.Provider,{value:t},e.children)}}}]);