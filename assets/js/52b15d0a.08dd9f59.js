"use strict";(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([[715],{1831:(e,s,t)=>{t.r(s),t.d(s,{assets:()=>c,contentTitle:()=>a,default:()=>h,frontMatter:()=>o,metadata:()=>n,toc:()=>d});const n=JSON.parse('{"id":"detectors/soroban/assert-violation","title":"Assert violation","description":"Description","source":"@site/docs/detectors/soroban/15-assert-violation.md","sourceDirName":"detectors/soroban","slug":"/detectors/soroban/assert-violation","permalink":"/docs/detectors/soroban/assert-violation","draft":false,"unlisted":false,"editUrl":"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/detectors/soroban/15-assert-violation.md","tags":[],"version":"current","sidebarPosition":15,"frontMatter":{},"sidebar":"tutorialSidebar","previous":{"title":"Iterators over indexing","permalink":"/docs/detectors/soroban/iterators-over-indexing"},"next":{"title":"Unprotected mapping operation","permalink":"/docs/detectors/soroban/unprotected-mapping-operation"}}');var r=t(5105),i=t(6755);const o={},a="Assert violation",c={},d=[{value:"Description",id:"description",level:2},{value:"Why is it bad?",id:"why-is-it-bad",level:2},{value:"Issue example",id:"issue-example",level:2},{value:"Remediated example",id:"remediated-example",level:2},{value:"How is it detected?",id:"how-is-it-detected",level:2},{value:"References",id:"references",level:2}];function l(e){const s={a:"a",code:"code",h1:"h1",h2:"h2",header:"header",li:"li",p:"p",pre:"pre",ul:"ul",...(0,i.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(s.header,{children:(0,r.jsx)(s.h1,{id:"assert-violation",children:"Assert violation"})}),"\n",(0,r.jsx)(s.h2,{id:"description",children:"Description"}),"\n",(0,r.jsxs)(s.ul,{children:["\n",(0,r.jsxs)(s.li,{children:["Category: ",(0,r.jsx)(s.code,{children:"Validations and error handling"})]}),"\n",(0,r.jsxs)(s.li,{children:["Severity: ",(0,r.jsx)(s.code,{children:"Enhancement"})]}),"\n",(0,r.jsxs)(s.li,{children:["Detector: ",(0,r.jsx)(s.a,{href:"https://github.com/CoinFabrik/scout-soroban/tree/main/detectors/assert-violation",children:(0,r.jsx)(s.code,{children:"assert-violation"})})]}),"\n",(0,r.jsxs)(s.li,{children:["Test Cases: ",(0,r.jsx)(s.a,{href:"https://github.com/CoinFabrik/scout-soroban/tree/main/test-cases/assert-violation/assert-violation-1",children:(0,r.jsx)(s.code,{children:"assert-violation-1"})})]}),"\n"]}),"\n",(0,r.jsxs)(s.p,{children:["The ",(0,r.jsx)(s.code,{children:"assert!"})," macro is used in Rust to ensure that a certain condition holds true at a certain point in your code."]}),"\n",(0,r.jsx)(s.h2,{id:"why-is-it-bad",children:"Why is it bad?"}),"\n",(0,r.jsxs)(s.p,{children:["The ",(0,r.jsx)(s.code,{children:"assert!"})," macro can cause the contract to panic. It is recommended to avoid this, because it stops its execution, which might lead the contract to an inconsistent state if the panic occurs in the middle of state changes. Additionally, the panic could cause a transaction to fail."]}),"\n",(0,r.jsx)(s.h2,{id:"issue-example",children:"Issue example"}),"\n",(0,r.jsxs)(s.p,{children:["Consider the following ",(0,r.jsx)(s.code,{children:"Soroban"})," contract:"]}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-rust",children:'    pub fn assert_if_greater_than_10(_env: Env, value: u128) -> bool {\n        assert!(value <= 10, "value should be less than 10");\n        true\n    }\n'})}),"\n",(0,r.jsxs)(s.p,{children:["The problem arises from the use of the ",(0,r.jsx)(s.code,{children:"assert!"})," macro, if the condition is not met, the contract panics."]}),"\n",(0,r.jsxs)(s.p,{children:["The code example can be found ",(0,r.jsx)(s.a,{href:"https://github.com/CoinFabrik/scout-soroban/tree/main/test-cases/assert-violation/assert-violation-1/vulnerable-example",children:"here"}),"."]}),"\n",(0,r.jsx)(s.h2,{id:"remediated-example",children:"Remediated example"}),"\n",(0,r.jsxs)(s.p,{children:["Avoid the use of ",(0,r.jsx)(s.code,{children:"assert!"})," macro. Instead, use a proper error and return it."]}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-rust",children:"    pub fn assert_if_greater_than_10(_env: Env, value: u128) -> Result<bool, AVError> {\n        if value <= 10 {\n            Ok(true)\n        } else {\n            Err(AVError::GreaterThan10)\n        }\n    }\n"})}),"\n",(0,r.jsxs)(s.p,{children:["The remediated code example can be found ",(0,r.jsx)(s.a,{href:"https://github.com/CoinFabrik/scout-soroban/tree/main/test-cases/assert-violation/assert-violation-1/remediated-example",children:"here"}),"."]}),"\n",(0,r.jsx)(s.h2,{id:"how-is-it-detected",children:"How is it detected?"}),"\n",(0,r.jsxs)(s.p,{children:["Checks for ",(0,r.jsx)(s.code,{children:"assert!"})," macro usage."]}),"\n",(0,r.jsx)(s.h2,{id:"references",children:"References"}),"\n",(0,r.jsxs)(s.ul,{children:["\n",(0,r.jsx)(s.li,{children:(0,r.jsx)(s.a,{href:"https://docs.alephzero.org/aleph-zero/security-course-by-kudelski-security/ink-developers-security-guideline#assert-violation",children:"Assert violation"})}),"\n"]})]})}function h(e={}){const{wrapper:s}={...(0,i.R)(),...e.components};return s?(0,r.jsx)(s,{...e,children:(0,r.jsx)(l,{...e})}):l(e)}},6755:(e,s,t)=>{t.d(s,{R:()=>o,x:()=>a});var n=t(8101);const r={},i=n.createContext(r);function o(e){const s=n.useContext(i);return n.useMemo((function(){return"function"==typeof e?e(s):{...s,...e}}),[s,e])}function a(e){let s;return s=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:o(e.components),n.createElement(i.Provider,{value:s},e.children)}}}]);