"use strict";(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([[8156],{4707:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>l,contentTitle:()=>o,default:()=>u,frontMatter:()=>a,metadata:()=>i,toc:()=>c});const i=JSON.parse('{"id":"detectors/soroban/insufficiently-random-values","title":"Insufficiently random values","description":"Description","source":"@site/docs/detectors/soroban/5-insufficiently-random-values.md","sourceDirName":"detectors/soroban","slug":"/detectors/soroban/insufficiently-random-values","permalink":"/docs/detectors/soroban/insufficiently-random-values","draft":false,"unlisted":false,"editUrl":"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/detectors/soroban/5-insufficiently-random-values.md","tags":[],"version":"current","sidebarPosition":5,"frontMatter":{},"sidebar":"tutorialSidebar","previous":{"title":"Overflow-check","permalink":"/docs/detectors/soroban/overflow-check"},"next":{"title":"Unprotected update current contract wasm","permalink":"/docs/detectors/soroban/unprotected-update-current-contract-wasm"}}');var s=t(5105),r=t(6755);const a={},o="Insufficiently random values",l={},c=[{value:"Description",id:"description",level:2},{value:"Why is this bad?",id:"why-is-this-bad",level:2},{value:"Issue example",id:"issue-example",level:2},{value:"Remediated example",id:"remediated-example",level:2},{value:"How is it detected?",id:"how-is-it-detected",level:2},{value:"References",id:"references",level:2}];function d(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",header:"header",li:"li",p:"p",pre:"pre",ul:"ul",...(0,r.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.header,{children:(0,s.jsx)(n.h1,{id:"insufficiently-random-values",children:"Insufficiently random values"})}),"\n",(0,s.jsx)(n.h2,{id:"description",children:"Description"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["Category: ",(0,s.jsx)(n.code,{children:"Block attributes"})]}),"\n",(0,s.jsxs)(n.li,{children:["Severity: ",(0,s.jsx)(n.code,{children:"Critical"})]}),"\n",(0,s.jsxs)(n.li,{children:["Detector: ",(0,s.jsx)(n.a,{href:"https://github.com/CoinFabrik/scout-soroban/tree/main/detectors/insufficiently-random-values",children:(0,s.jsx)(n.code,{children:"insufficiently-random-values"})})]}),"\n",(0,s.jsxs)(n.li,{children:["Test Cases: ",(0,s.jsx)(n.a,{href:"https://github.com/CoinFabrik/scout-soroban/tree/main/test-cases/insufficiently-random-values/insufficiently-random-values-1",children:(0,s.jsx)(n.code,{children:"insufficiently-random-values-1"})})]}),"\n"]}),"\n",(0,s.jsxs)(n.p,{children:["Using block attributes like ",(0,s.jsx)(n.code,{children:"timestamp"})," or ",(0,s.jsx)(n.code,{children:"sequence"})," for random number generation in Soroban smart contracts is not recommended due to the predictability of these values. Block attributes are publicly visible and deterministic, making it easy for malicious actors to anticipate their values and manipulate outcomes to their advantage. It's important to use a source that is both unpredictable and external to the blockchain environment, reducing the potential for malicious exploitation."]}),"\n",(0,s.jsx)(n.h2,{id:"why-is-this-bad",children:"Why is this bad?"}),"\n",(0,s.jsxs)(n.p,{children:["Using ",(0,s.jsx)(n.code,{children:"ledger().timestamp()"})," is not recommended because it could be potentially manipulated by validator, which might lead to potential problems. On the other hand, ",(0,s.jsx)(n.code,{children:"ledger().sequence()"})," is publicly available. An attacker could predict the random number to be generated to manipulate the code and perform an attack on the contract."]}),"\n",(0,s.jsx)(n.h2,{id:"issue-example",children:"Issue example"}),"\n",(0,s.jsxs)(n.p,{children:["Consider the following ",(0,s.jsx)(n.code,{children:"Soroban"})," contract:"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-rust",children:"pub fn generate_random_value_timestamp(env: Env, max_val: u64) -> Result<u64, Error> {\n        if max_val == 0 {\n            Err(Error::MaxValZero)\n        } else {\n            let val = env.ledger().timestamp() % max_val;\n            Ok(val)\n        }\n    }\n    \n    pub fn generate_random_value_sequence(env: Env, max_val: u32) -> Result<u32, Error> {\n        if max_val == 0 {\n            Err(Error::MaxValZero)\n        } else {\n            let val = env.ledger().sequence() % max_val;\n            Ok(val)\n        }\n    }\n    \n"})}),"\n",(0,s.jsx)(n.p,{children:"The issue lies in these functions use of blockchain-provided data like block timestamp and sequence number for pseudo-random number generation. This reliance on predictable blockchain data makes the generated values susceptible to manipulation by attackers."}),"\n",(0,s.jsxs)(n.p,{children:["The code example can be found ",(0,s.jsx)(n.a,{href:"https://github.com/CoinFabrik/scout-soroban/tree/main/test-cases/insufficiently-random-values/insufficiently-random-values-1/vulnerable-example",children:"here"}),"."]}),"\n",(0,s.jsx)(n.h2,{id:"remediated-example",children:"Remediated example"}),"\n",(0,s.jsxs)(n.p,{children:["Avoid using block attributes like ",(0,s.jsx)(n.code,{children:"timestamp"})," or ",(0,s.jsx)(n.code,{children:"sequence"})," for randomness generation, and consider using PRNG instead."]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-rust",children:"\n  pub fn generate_random_value(env: Env, max_val: u64) -> Result<u64, Error> {\n        if max_val == 0 {\n            Err(Error::MaxValZero)\n        } else {\n            let val = env.prng().gen_range(0..max_val);\n            Ok(val)\n        }\n    }\n        \n"})}),"\n",(0,s.jsxs)(n.p,{children:["The remediated code example can be found ",(0,s.jsx)(n.a,{href:"https://github.com/CoinFabrik/scout-soroban/tree/main/test-cases/insufficiently-random-values/insufficiently-random-values-1/remediated-example",children:"here"}),"."]}),"\n",(0,s.jsx)(n.h2,{id:"how-is-it-detected",children:"How is it detected?"}),"\n",(0,s.jsxs)(n.p,{children:["Checks the usage of ",(0,s.jsx)(n.code,{children:"ledger().timestamp()"})," or ",(0,s.jsx)(n.code,{children:"ledger().sequence()"})," for generation of random numbers."]}),"\n",(0,s.jsx)(n.h2,{id:"references",children:"References"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.a,{href:"https://dasp.co/#item-6",children:"https://dasp.co/#item-6"})}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.a,{href:"https://blog.sigmaprime.io/solidity-security.html#SP-6",children:"https://blog.sigmaprime.io/solidity-security.html#SP-6"})}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.a,{href:"https://swcregistry.io/docs/SWC-120",children:"SWC-120"})}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.a,{href:"https://swcregistry.io/docs/SWC-116",children:"SWC-116"})}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.a,{href:"https://ethernaut.openzeppelin.com/level/0x4dF32584890A0026e56f7535d0f2C6486753624f",children:"Ethernaut: Coinflip"})}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.a,{href:"https://github.com/crytic/slither/wiki/Detector-Documentation#weak-PRNG",children:"Slither: Weak PRNG"})}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.a,{href:"https://github.com/crytic/slither/wiki/Detector-Documentation#block-timestamp",children:"Slither: Dangerous usage of block.timestamp"})}),"\n"]}),"\n"]})]})}function u(e={}){const{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(d,{...e})}):d(e)}},6755:(e,n,t)=>{t.d(n,{R:()=>a,x:()=>o});var i=t(8101);const s={},r=i.createContext(s);function a(e){const n=i.useContext(r);return i.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function o(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:a(e.components),i.createElement(r.Provider,{value:n},e.children)}}}]);