"use strict";(globalThis.webpackChunkdocs=globalThis.webpackChunkdocs||[]).push([[5853],{6660(e,t,a){a.r(t),a.d(t,{assets:()=>c,contentTitle:()=>r,default:()=>u,frontMatter:()=>o,metadata:()=>n,toc:()=>d});const n=JSON.parse('{"id":"detectors/soroban/uncached-storage-modification","title":"Uncached storage modification","description":"Description","source":"@site/docs/detectors/soroban/30-uncached-storage-modification.md","sourceDirName":"detectors/soroban","slug":"/detectors/soroban/uncached-storage-modification","permalink":"/scout-audit/docs/detectors/soroban/uncached-storage-modification","draft":false,"unlisted":false,"editUrl":"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/detectors/soroban/30-uncached-storage-modification.md","tags":[],"version":"current","sidebarPosition":30,"frontMatter":{},"sidebar":"tutorialSidebar","previous":{"title":"Missing new admin signature","permalink":"/scout-audit/docs/detectors/soroban/missing-new-admin-auth"},"next":{"title":"Substrate Pallets","permalink":"/scout-audit/docs/category/substrate-pallets"}}');var s=a(2615),i=a(7545);const o={},r="Uncached storage modification",c={},d=[{value:"Description",id:"description",level:2},{value:"Why is this bad?",id:"why-is-this-bad",level:2},{value:"Issue example",id:"issue-example",level:2},{value:"Remediated example",id:"remediated-example",level:2},{value:"How is it detected?",id:"how-is-it-detected",level:2}];function l(e){const t={a:"a",code:"code",h1:"h1",h2:"h2",header:"header",li:"li",p:"p",pre:"pre",ul:"ul",...(0,i.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(t.header,{children:(0,s.jsx)(t.h1,{id:"uncached-storage-modification",children:"Uncached storage modification"})}),"\n",(0,s.jsx)(t.h2,{id:"description",children:"Description"}),"\n",(0,s.jsxs)(t.ul,{children:["\n",(0,s.jsxs)(t.li,{children:["Category: ",(0,s.jsx)(t.code,{children:"Known Bugs"})]}),"\n",(0,s.jsxs)(t.li,{children:["Severity: ",(0,s.jsx)(t.code,{children:"Medium"})]}),"\n",(0,s.jsxs)(t.li,{children:["Detector: ",(0,s.jsx)(t.a,{href:"https://github.com/CoinFabrik/scout-soroban/tree/main/detectors/uncached-storage-modification",children:(0,s.jsx)(t.code,{children:"uncached-storage-modification"})})]}),"\n",(0,s.jsxs)(t.li,{children:["Test Cases: ",(0,s.jsx)(t.a,{href:"https://github.com/CoinFabrik/scout-soroban/tree/main/test-cases/uncached-storage-modification/uncached-storage-modification-1",children:(0,s.jsx)(t.code,{children:"uncached-storage-modification-1"})})]}),"\n"]}),"\n",(0,s.jsx)(t.p,{children:"When a storage value is read into a local variable, mutated, and the same key is read again without writing the updated value back, the second read returns stale data. This can lead to incorrect state transitions and logic errors."}),"\n",(0,s.jsx)(t.h2,{id:"why-is-this-bad",children:"Why is this bad?"}),"\n",(0,s.jsx)(t.p,{children:"A stale re-read can cause logic that depends on the updated value to use outdated data. This is a cache coherence bug that can silently corrupt state."}),"\n",(0,s.jsx)(t.h2,{id:"issue-example",children:"Issue example"}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-rust",children:"let mut value: i32 = env\n    .storage()\n    .persistent()\n    .get(&DataKey::Value(key.clone()))\n    .unwrap_or(0);\n\nvalue += 1;\n\nlet reread: i32 = env\n    .storage()\n    .persistent()\n    .get(&DataKey::Value(key))\n    .unwrap_or(0);\n"})}),"\n",(0,s.jsx)(t.p,{children:"In this example, the value is modified in memory but never written back to storage before a second read."}),"\n",(0,s.jsx)(t.h2,{id:"remediated-example",children:"Remediated example"}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-rust",children:"let mut value: i32 = env\n    .storage()\n    .persistent()\n    .get(&DataKey::Value(key.clone()))\n    .unwrap_or(0);\n\nvalue += 1;\n\nenv.storage()\n    .persistent()\n    .set(&DataKey::Value(key.clone()), &value);\n\nlet reread: i32 = env\n    .storage()\n    .persistent()\n    .get(&DataKey::Value(key))\n    .unwrap_or(0);\n"})}),"\n",(0,s.jsx)(t.p,{children:"The modified value is written back to storage before the key is read again."}),"\n",(0,s.jsx)(t.h2,{id:"how-is-it-detected",children:"How is it detected?"}),"\n",(0,s.jsx)(t.p,{children:"The detector tracks storage reads into locals, marks them dirty on mutation, and reports when the same key is read again without a write in between."})]})}function u(e={}){const{wrapper:t}={...(0,i.R)(),...e.components};return t?(0,s.jsx)(t,{...e,children:(0,s.jsx)(l,{...e})}):l(e)}},7545(e,t,a){a.d(t,{R:()=>o,x:()=>r});var n=a(9471);const s={},i=n.createContext(s);function o(e){const t=n.useContext(i);return n.useMemo(function(){return"function"==typeof e?e(t):{...t,...e}},[t,e])}function r(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:o(e.components),n.createElement(i.Provider,{value:t},e.children)}}}]);