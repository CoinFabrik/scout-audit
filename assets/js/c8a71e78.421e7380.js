"use strict";(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([[7037],{3774:(e,t,n)=>{n.d(t,{R:()=>r,x:()=>o});var s=n(6672);const i={},a=s.createContext(i);function r(e){const t=s.useContext(a);return s.useMemo((function(){return"function"==typeof e?e(t):{...t,...e}}),[t,e])}function o(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:r(e.components),s.createElement(a.Provider,{value:t},e.children)}},8918:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>c,contentTitle:()=>o,default:()=>u,frontMatter:()=>r,metadata:()=>s,toc:()=>d});const s=JSON.parse('{"id":"detectors/substrate/assert-violation","title":"Assert violation","description":"Description","source":"@site/docs/detectors/substrate/assert-violation.md","sourceDirName":"detectors/substrate","slug":"/detectors/substrate/assert-violation","permalink":"/scout-audit/docs/detectors/substrate/assert-violation","draft":false,"unlisted":false,"editUrl":"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/detectors/substrate/assert-violation.md","tags":[],"version":"current","frontMatter":{},"sidebar":"tutorialSidebar","previous":{"title":"Substrate Pallets","permalink":"/scout-audit/docs/category/substrate-pallets"},"next":{"title":"Avoid debug!() info!()","permalink":"/scout-audit/docs/detectors/substrate/avoid-debug-info"}}');var i=n(3420),a=n(3774);const r={},o="Assert violation",c={},d=[{value:"Description",id:"description",level:2},{value:"Why is this bad?",id:"why-is-this-bad",level:3},{value:"Example",id:"example",level:3},{value:"Remediated example",id:"remediated-example",level:2},{value:"How is it detected?",id:"how-is-it-detected",level:2}];function l(e){const t={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",p:"p",pre:"pre",ul:"ul",...(0,a.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(t.header,{children:(0,i.jsx)(t.h1,{id:"assert-violation",children:"Assert violation"})}),"\n",(0,i.jsx)(t.h2,{id:"description",children:"Description"}),"\n",(0,i.jsxs)(t.ul,{children:["\n",(0,i.jsxs)(t.li,{children:["Category: ",(0,i.jsx)(t.code,{children:"Validations and error handling"})]}),"\n",(0,i.jsxs)(t.li,{children:["Severity: ",(0,i.jsx)(t.code,{children:"Enhancement"})]}),"\n",(0,i.jsxs)(t.li,{children:["Detectors: ",(0,i.jsx)(t.a,{href:"https://github.com/CoinFabrik/scout-audit/blob/main/detectors/rust/assert-violation/src/lib.rs",children:"assert-violation"})]}),"\n"]}),"\n",(0,i.jsxs)(t.p,{children:["The ",(0,i.jsx)(t.code,{children:"assert!"})," macro is used in Rust to ensure that a certain condition holds true at a certain point in your code."]}),"\n",(0,i.jsx)(t.h3,{id:"why-is-this-bad",children:"Why is this bad?"}),"\n",(0,i.jsxs)(t.p,{children:["The ",(0,i.jsx)(t.code,{children:"assert!"})," macro can cause the contract to panic. It is recommended to avoid this, because it stops its execution, which might lead the contract to an inconsistent state if the panic occurs in the middle of state changes. Additionally, the panic could cause a transaction to fail."]}),"\n",(0,i.jsx)(t.h3,{id:"example",children:"Example"}),"\n",(0,i.jsx)(t.p,{children:"Consider the following substrate pallet:"}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-rust",children:'pub fn unsafe_check_balance(origin: OriginFor<T>, amount: u32) -> DispatchResult {\n    let who = ensure_signed(origin)?;\n    assert!(\n        BalanceStorage::<T>::get().unwrap_or(0) >= amount,\n        "Insufficient balance"\n    );\n\n    Self::deposit_event(Event::BalanceChecked { who, amount });\n    Ok(())\n}\n'})}),"\n",(0,i.jsx)(t.h2,{id:"remediated-example",children:"Remediated example"}),"\n",(0,i.jsx)(t.p,{children:"Consider using a proper error and return it:"}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-rust",children:"pub fn unsafe_check_balance(origin: OriginFor<T>, amount: u32) -> DispatchResult {\n    let who = ensure_signed(origin)?;\n    if BalanceStorage::<T>::get().unwrap_or(0) < amount {\n        return Err(Error::<T>::InvalidBalance.into());\n    }\n\n    Self::deposit_event(Event::BalanceChecked { who, amount });\n    Ok(())\n}\n"})}),"\n",(0,i.jsx)(t.h2,{id:"how-is-it-detected",children:"How is it detected?"}),"\n",(0,i.jsxs)(t.p,{children:["Checks for ",(0,i.jsx)(t.code,{children:"assert!"})," macro usage."]})]})}function u(e={}){const{wrapper:t}={...(0,a.R)(),...e.components};return t?(0,i.jsx)(t,{...e,children:(0,i.jsx)(l,{...e})}):l(e)}}}]);